# SpringSecurity-JWT ë€ ë¬´ì—‡ì¸ê°€?

</br>

ğŸ‘‰ğŸ‘‰ğŸ‘‰ [[Spring Security] JWT(JSON Web Token) ì˜ ëª¨ë“  ê²ƒ - ì°°ë‚˜ì˜ ê°œë°œí”ì ](https://aonee.tistory.com/70, "aonee ì°°ë‚˜ì˜ ê°œë°œí”ì  í‹°ìŠ¤í† ë¦¬ í¬ìŠ¤íŒ…")

</br>

## 1. ì •ì˜

**#JSON 	#Claim_based_Token 	#Self_contained**

JSON Web Tokenì˜ ì•½ìë¡œ í´ë ˆì„ í† í° ê¸°ë°˜ì˜ ë°©ì‹. 

í´ë¼ì´ì–¸íŠ¸ì˜ ì„¸ì…˜ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ 
í•„ìš”í•œ ì •ë³´ë¥¼ í† í° bodyì— ì €ì¥í•´ í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥í•´ë‘ê³  ì´ë¥¼ ì¦ëª…ì„œ ì²˜ëŸ¼ ì‚¬ìš©í•œë‹¤.

> Claim based?

- Claim : ì‚¬ìš©ìì— ëŒ€í•œ í”„ë¡œí¼í‹° / ì†ì„±
- í† í° ìì²´ê°€ ì •ë³´
- Self-contained : ìì²´ í¬í•¨, ì¦‰ í† í° ìì²´ê°€ ì •ë³´
- key / value ë¡œ ì´ë£¨ì–´ì§



## 2. êµ¬ì„±

{Header}.{Payload}.{Verify Signature}
3ê°€ì§€ ì •ë³´ë¥¼ '.'ë¡œ ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

> [JWT ê³µì‹ì‚¬ì´íŠ¸](https://jwt.io/) ë¥¼ í†µí•´ JWTë¥¼ ìƒì„± ë° ê²€ì¦í•  ìˆ˜ ìˆë‹¤.



![image](https://user-images.githubusercontent.com/49062985/81495668-f2b35e80-92ec-11ea-82ec-d886f275c0da.png)



**Header** : JWT í† í°ì˜ ìœ í˜•ì´ë‚˜ ì‚¬ìš©ëœ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ì˜ ì •ë³´ê°€ ë“¤ì–´ê°„ë‹¤.

**Payload** : í´ë ˆì„(Claims)ì„ í¬í•¨í•œë‹¤. ì¦‰, í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì •ë³´ê°€ ë‹´ê²¨ìˆë‹¤. 
				ë˜í•œ ì—¬ê¸°ì—ëŠ” iss, sub, aud, exp, nbf, iat, jti ì™€ ê°™ì€ ê¸°ë³¸ ì •ë³´ê°€ ë“¤ì–´ê°„ë‹¤.

> **1. ë“±ë¡ëœ í´ë ˆì„** ( [**Registered claims**](https://tools.ietf.org/html/rfc7519#section-4.1) **)**
> ì´ë¯¸ ì •ì˜ëœ í´ë ˆì„ë“¤ë¡œ ë¬´ì¡°ê±´ ë”°ë¼ì•¼ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ ê¶Œì¥í•œë‹¤. 
> **iss** (issuer, í† í° ë°œí–‰ì), **exp** (expiration time, í† í° ë§Œë£Œì‹œê°„), **sub** (subject, í† í° ì œëª©), **aud**(audience, í† í° ëŒ€ìƒì) ì™€ ê°™ì€ í´ë ˆì„ë“¤ì´ ìˆìŠµë‹ˆë‹¤. 
> í´ë ˆì„ì˜ ì´ë¦„ì€ compactë¥¼ ìœ„í•´ 3ê¸€ìë¡œ ì‚¬ìš©í•œë‹¤.
>
> **2. ê³µê°œëœ í´ë ˆì„** ( [**Public claims**](https://tools.ietf.org/html/rfc7519#section-4.2) )
> JWTë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒë“¤ì— ì˜í•´ ì •ì˜ë˜ëŠ” í´ë ˆì„ì´ë‹¤. 
> í´ë ˆì„ ì¶©ëŒì„ í”¼í•˜ê¸° ìœ„í•´ì„œ [IANA JSON Web Token Registry](https://www.iana.org/assignments/jwt/jwt.xhtml) ì— ì •ì˜í•˜ê±°ë‚˜ URI í˜•ì‹ìœ¼ë¡œ ì •ì˜í•´ì•¼ í•œë‹¤.
>
> **3. ë¹„ê³µê°œ í´ë ˆì„** ( [**Private claims**](https://tools.ietf.org/html/rfc7519#section-4.3) )
> GUI, ì„œë²„, ê·¸ ì™¸ ëª¨ë“ˆê°„ì— í˜‘ì˜í•œ í´ë ˆì„ì´ë‹¤.

**Signature** : headerì—ì„œ ì§€ì •í•œ ì•Œê³ ë¦¬ì¦˜ê³¼ secret keyë¡œ Headerì™€ Payloadë¥¼ ë‹´ëŠ”ë‹¤.

> ì„œëª…ì„ í†µí•´ ë©”ì‹œì§€ê°€ ì¤‘ê°„ì— ë³€ê²½ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„ ê²€ì¦í•˜ë©°, 
> JWTë¥¼ ë³´ë‚¸ ì‚¬ëŒì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ëŒ€ìƒì´ë¼ëŠ” ê²ƒë„ ì•Œ ìˆ˜ ìˆë‹¤.



## 3. íŠ¹ì§•

- **1. í‘œì¤€ RFC 7519**
  JSON Web Tokenì€ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ì†¡í•˜ê¸° ìœ„í•´ ì •ì˜ëœ ê³µê°œëœ í‘œì¤€ (RFC 7519) ì´ë‹¤

- **2. Self-contained ( ìê°€ ìˆ˜ìš©ì  )**
  JWT ìì²´ì ìœ¼ë¡œ í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ í¬í•¨í•œë‹¤.
  í—¤ë” ì •ë³´ì™€, ì‹¤ì œ ì „ë‹¬í•  ë°ì´í„°, ê²€ì¦í•  ìˆ˜ ìˆëŠ” ì„œëª… ë°ì´í„°ë¥¼ ëª¨ë‘ í¬í•¨í•˜ê³  ìˆë‹¤.

- **3. ì‹ ë¢° ê°€ëŠ¥**
  JWTëŠ” ë””ì§€í„¸ ì„œëª…ì— ì˜í•´ ê²€ì¦í•  ìˆ˜ ìˆìœ¼ë©° ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤.
  ë¹„ë°€ ê°’ì„ ì‚¬ìš©í•˜ëŠ” HMAC ì•Œê³ ë¦¬ì¦˜ì´ë‚˜ RDS or ECDSAì™€ ê°™ì€ ê³µê°œí‚¤, ê°œì¸í‚¤ ìŒìœ¼ë¡œ ì„œëª…ë  ìˆ˜ ìˆë‹¤.

- **4. PayloadëŠ” ê³µê°œ ë°ì´í„°**

  JWTì— ì •ë³´ëŠ” ëˆ„êµ¬ë‚˜ https://jwt.io/ í˜ì´ì§€ì— ì ‘ì†í•´ì„œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  ë”°ë¼ì„œ ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì€ ë³´ì•ˆì´ í•„ìš”í•œ ì •ë³´ëŠ” payloadì— ì €ì¥í•˜ë©´ ì•ˆëœë‹¤.

- **5. JWTì˜ Secret Key**

  JWTì—ì„œëŠ” ì •ë³´ëŠ” ê³µê°œê°€ ë˜ì–´ìˆì§€ë§Œ í•´ì‹œ ê°’ì„ í†µí•´ì„œ ì •ë³´ê°€ ìœ íš¨í•œì§€ í™•ì¸ì„ í•˜ê²Œ ë©ë‹ˆë‹¤. 
  ë”°ë¼ì„œ ì‹œí¬ë¦¿ í‚¤ê°€ ìœ ì¶œì´ ëœë‹¤ë©´ JWTì—ì„œ ë³´ì•ˆìƒì— í° ìœ„í˜‘ì´ ëœë‹¤.



## 4. ê³¼ì •

- **4.1 ë¡œê·¸ì¸**

  ![image](https://user-images.githubusercontent.com/49062985/81495542-e8449500-92eb-11ea-9cc5-316568379779.png)

  - clientëŠ” Auth Serverì— ë¡œê·¸ì¸ì„ í•©ë‹ˆë‹¤. ì´ë•Œ Auth ServerëŠ” application server ë‚´ì— ìœ„ì¹˜í•  ìˆ˜ë„ ìˆìœ¼ë©°, facebook, gooleê³¼ ê°™ì€ ì œ 3ìê°€ ë  ìˆ˜ë„ ìˆë‹¤.

    â€¢ Auth Serverì—ì„œ ì¸ì¦ì„ ì™„ë£Œí•œ ì‚¬ìš©ìëŠ” JWT Tokenì„ ì „ë‹¬ë°›ëŠ”ë‹¤.

    â€¢ clientëŠ” application serverì— resourceë¥¼ ìš”ì²­í• ë•Œ ì•ì„œ ì „ë‹¬ë°›ì€ JWT Tokenì„ Authorization Headerì— ì „ë‹¬í•œë‹¤.

    â€¢ application serverëŠ” ì „ë‹¬ë°›ì€ JWT Tokenì´ ìœ íš¨í•˜ë©´ 200 okì™€ í•¨ê»˜ dataë¥¼ response í•œë‹¤.

    > ì´ë•Œ ì¤‘ìš”í•œì ì€ application serverê°€ ë”ì´ìƒ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ sessionì„ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ë‹¨ì§€ ì „ë‹¬ë°›ì€ JWTê°€ ìœ íš¨í•œ Tokenì¸ì§€ë§Œ í™•ì¸í•˜ë©´ ëœë‹¤. 

    ë˜í•œ, outside domainì¸ clientê°€ application serverì— resourceë¥¼ ìš”ì²­í•˜ê¸°ìœ„í•´ application serverëŠ” corsë¥¼ enable í•´ì•¼í•œë‹¤.

    corsë¥¼ enable í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ application serverëŠ” ì™¸ë¶€ domainì— resource ì ‘ê·¼ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

    

- **4.2 ì‚¬ìš© í™˜ê²½ **

  ![image](https://user-images.githubusercontent.com/49062985/81495622-8c2e4080-92ec-11ea-971a-f9e1ec2689bf.png)

  * í•˜ë‚˜ì˜ End Pointê°€ ì•„ë‹Œ Mobile/Web ë“±ì˜ multiple endpoint í™˜ê²½ì´ë¼ë©´ í†µí•©ì ì¸ ì¸ì¦/ì¸ê°€ í™˜ê²½ì„ ì œê³µí•˜ê¸°ìœ„í•´ì„  ë°˜ë“œì‹œ JWTë¥¼ ì‚¬ìš©í•œë‹¤.

  * ë³´í¸ì ì¸ ì˜ˆë¡œ, Reactë¡œ clientë¥¼ êµ¬ì„±í•˜ê³  REST API ì„œë²„ë¥¼ ë”°ë¡œ ë‘ëŠ” ê²½ìš°ì—ëŠ” JWTë¥¼ ì‚¬ìš©í•œë‹¤.

  * 3rd partyì—ê²Œ public í•˜ê²Œ open í•œ REST Endpointê°€ ì¡´ì¬í•  ê²½ìš° í•´ë‹¹ 3rd partyì˜ ì¸ì¦/ì¸ê°€ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ JWTë¥¼ ì‚¬ìš©í•œë‹¤.

  


## 5. ì¥ì  / ë‹¨ì  & ë„ì…ì‹œ ê³ ë ¤ì‚¬í•­

### ì¥ì 

1. ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸(web,ios,android) ì»¤ë²„ ê°€ëŠ¥

2. ë³´ì•ˆ ì´ìŠˆ
   ì‚¬ìš©ìê°€ ìì‹ ì˜ ë¹„ë°€ ê°’ìœ¼ë¡œ ì„œë²„ì— ë¡œê·¸ì¸ í•˜ê²Œ ë˜ë©´, ì„œë²„ëŠ” JWTë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤. **tokenì„ ì¸ì¦ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ê¸°ì¡´ ì¿ í‚¤/ì„¸ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ë³´ë‹¤ ë§ì€ ë³´ì•ˆ ì´ìŠˆë¥¼ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì„œë²„ëŠ” GUIë¡œë¶€í„° ë°›ì€ JWTê°€ ìœ íš¨í•  ê²½ìš°, resouceë¥¼ ì‚¬ìš©í•˜ë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ë˜í•œ JWTëŠ” ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, Cross-Origin Resource Sharing (CORS) ì´ìŠˆê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

3. ë°ì´í„° ìš©ëŸ‰: JWTëŠ” ê¸°ì¡´ì˜ XMLë³´ë‹¤ ëœ ë³µì¡í•˜ê³  ì¸ì½”ë”© ëœ ì‚¬ì´ì¦ˆê°€ ì‘ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ HTTPì™€ HTML í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.

4. ì‚¬ìš©ì„±: JSON parserëŠ” ëŒ€ë¶€ë¶„ì˜ í”„ë¡œê·¸ë˜ë°ì´ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— XMLì„ ì‚¬ìš©í•˜ëŠ” SAML ë³´ë‹¤ ë§Œë“¤ê¸° ì‰½ìŠµë‹ˆë‹¤.

5. CORS(Cross-origin resource sharing) ë¬¸ì œë•Œë¬¸ì— ì£¼ë¡œ ì“´ë‹¤.

6. sessionì˜ í•œê³„ ê·¹ë³µ ê°€ëŠ¥

   > **ì„¸ì…˜ì˜ í•œê³„**
   >
   > 1. ì„œë²„ í™•ì¥ì‹œ ì„¸ì…˜ ì •ë³´ì˜ ë™ê¸°í™” ë¬¸ì œ
   >
   >    > ì„œë²„ê°€ ìŠ¤ì¼€ì¼ì•„ì›ƒ ë¼ì„œ ì—¬ëŸ¬ ê°œê°€ ìƒê¸°ë©´ ê° ì„œë²„ë§ˆë‹¤ ì„¸ì…˜ ì •ë³´ê°€ ì €ì¥ë¡œê·¸ì¸ì‹œ(ì„œë²„1), ìƒˆë¡œê³ ì¹¨(ì„œë²„2) ë¡œ ì ‘ê·¼í•˜ë©´ ì„œë²„ëŠ” ì¸ì¦ì´ ì•ˆëë‹¤ê³  íŒë‹¨
   >
   > > 
   >
   > 2. ì„œë²„ / ì„¸ì…˜ ì €ì¥ì†Œì˜ ë¶€í•˜
   > 3. ì›¹ / ì•± ê°„ì˜ ìƒì´í•œ ì¿ í‚¤-ì„¸ì…˜ ì²˜ë¦¬ ë¡œì§



### ë‹¨ì  & ë„ì…ì‹œ ê³ ë ¤ì‚¬í•­

1. **Self-contained**
   í† í° ìì²´ì— ì •ë³´ê°€ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì€ ì–‘ë‚ ì˜ ê²€

2. **í† í° ê¸¸ì´**
   í† í° ìì²´ payload ì— Claim setì„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì •ë³´ê°€ ë§ì•„ì§ˆ ìˆ˜ë¡ í† í°ì˜ ê¸¸ì´ê°€ ëŠ˜ì–´ë‚˜ ë„¤íŠ¸ì›Œí¬ì— ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ ìˆìŒ

3. **payload ì•”í˜¸í™”**
   payload ìì²´ëŠ” ê·¸ëƒ¥ ì¸ì½”ë”©ëœ ë°ì´í„°
   ì¤‘ê°„ì— payloadë¥¼ íƒˆì·¨í•˜ë©´ ë””ì½”ë”©ì„ í†µí•´ í…Œì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìŒ
   payloadì— ì¤‘ìš” ë°ì´í„°ë¥¼ ë„£ì§€ ì•Šì•„ì•¼ í•¨

4. **Stateless**
   í† í°ì€ í•œë²ˆ ë§Œë“¤ë©´ ì„œë²„ì—ì„œ ì œì–´ê°€ ë¶ˆê°€ëŠ¥



ğŸ¥ ì°¸ê³ 

https://www.youtube.com/watch?v=x6bzYyMY0GA&list=PLVApX3evDwJ1d0lKKHssPQvzv2Ao3e__Q&index=4

[https://medium.com/sjk5766/jwt-json-web-token-%EC%86%8C%EA%B0%9C-49e211c65b45](https://medium.com/sjk5766/jwt-json-web-token-ì†Œê°œ-49e211c65b45)

https://sanghaklee.tistory.com/47



#

# SpringSecurity-JWT êµ¬í˜„
### jwtUtil

```
extractUsername
extractExpiration
extractClaim
extractAllClaims
isTokenExpired
createToken
validateToken
```

